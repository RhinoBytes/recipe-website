<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Create New Recipe - CookBook</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles/newRecipe.css" />
    <link rel="stylesheet" href="styles/nav.css" />
    <link rel="stylesheet" href="styles/styles.css" />
  </head>
  <body>
    <!-- Auto-save indicator -->
    <div class="auto-save" id="autoSaveIndicator">
      <i class="fas fa-check"></i> Draft saved
    </div>
    <!-- Header -->
    <header class="header">
      <div class="container">
        <nav class="nav">
          <a href="index.html" class="logo">
            <i class="fas fa-utensils"></i>
            Cookbook
          </a>

          <button class="nav-toggle" aria-label="Open menu">
            <i class="fas fa-bars"></i>
          </button>

          <div class="search-container">
            <i class="fas fa-search search-icon"></i>
            <input
              type="text"
              class="search-bar"
              placeholder="Search recipes, ingredients, or chefs..."
            />
          </div>

          <ul class="nav-links">
            <li><a href="search.html">Browse</a></li>
            <li><a href="search.html">Categories</a></li>
            <li><a href="search.html">Popular</a></li>
          </ul>

          <div class="user-actions">
            <!-- Desktop dropdown -->
            <div class="dropdown">
              <button class="btn btn-secondary dropdown-toggle">
                <i class="fas fa-user"></i> Login
                <i class="fas fa-caret-down"></i>
              </button>
              <div class="dropdown-menu">
                <a href="login.html" class="dropdown-item"
                  ><i class="fas fa-sign-in-alt"></i> Sign In</a
                >
                <a href="login.html" class="dropdown-item"
                  ><i class="fas fa-user-plus"></i> Register</a
                >
                <div class="dropdown-divider"></div>
                <a href="newRecipe.html" class="dropdown-item highlight"
                  ><i class="fas fa-plus"></i> Create Recipe</a
                >
              </div>
            </div>
          </div>

          <!-- Mobile auth links (will be toggled with nav) -->
          <div class="mobile-auth-links">
            <a href="login.html"><i class="fas fa-sign-in-alt"></i> Sign In</a>
            <a href="login.html"><i class="fas fa-user-plus"></i> Register</a>
            <a href="newRecipe.html"
              ><i class="fas fa-plus"></i> Create Recipe</a
            >
          </div>
        </nav>
      </div>
    </header>
    <script src="scripts/nav.js">
      // Mobile nav toggle
    </script>

    <!-- Main Content -->
    <div class="recipe-container">
      <div class="main-content">
        <!-- Recipe Form -->
        <div class="recipe-form">
          <!-- Entry Mode Toggle -->
          <div class="entry-mode-toggle">
            <div class="mode-tab active" onclick="switchMode('manual')">
              <i class="fas fa-edit"></i> Manual Entry
            </div>
            <div class="mode-tab" onclick="switchMode('paste')">
              <i class="fas fa-magic"></i> Paste & Format
            </div>
          </div>

          <!-- Manual Entry Mode -->
          <div id="manualMode" class="manual-container">
            <!-- Basic Information -->
            <div class="form-section">
              <h3 class="section-title">
                <i class="fas fa-info-circle section-icon"></i>
                Basic Information
              </h3>

              <div class="form-group">
                <label class="form-label required">Recipe Title</label>
                <input
                  type="text"
                  class="form-input"
                  id="recipeTitle"
                  placeholder="Enter your recipe title"
                  maxlength="100"
                />
              </div>

              <div class="form-group">
                <label class="form-label">Short Description</label>
                <textarea
                  class="form-textarea"
                  id="recipeDescription"
                  placeholder="Brief description of your recipe..."
                  rows="3"
                ></textarea>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label class="form-label">Category</label>
                  <select class="form-select" id="recipeCategory">
                    <option value="">Select Category</option>
                    <option value="breakfast">Breakfast</option>
                    <option value="lunch">Lunch</option>
                    <option value="dinner">Dinner</option>
                    <option value="dessert">Dessert</option>
                    <option value="appetizer">Appetizer</option>
                    <option value="beverage">Beverage</option>
                    <option value="salad">Salad</option>
                    <option value="soup">Soup</option>
                    <option value="snack">Snack</option>
                  </select>
                </div>

                <div class="form-group">
                  <label class="form-label">Difficulty Level</label>
                  <select class="form-select" id="recipeDifficulty">
                    <option value="">Select Difficulty</option>
                    <option value="beginner">Beginner</option>
                    <option value="intermediate">Intermediate</option>
                    <option value="advanced">Advanced</option>
                  </select>
                </div>
              </div>

              <div class="form-group">
                <label class="form-label">Tags</label>
                <input
                  type="text"
                  class="form-input"
                  id="recipeTags"
                  placeholder="Enter tags separated by commas (e.g., healthy, quick, vegetarian)"
                />
                <div class="tags-container" id="tagsContainer"></div>
              </div>
            </div>

            <!-- Recipe Details -->
            <div class="form-section">
              <h3 class="section-title">
                <i class="fas fa-clock section-icon"></i>
                Recipe Details
              </h3>

              <div class="form-row">
                <div class="form-group">
                  <label class="form-label">Prep Time</label>
                  <div class="time-picker">
                    <input
                      type="number"
                      class="form-input time-input"
                      id="prepHours"
                      placeholder="0"
                      min="0"
                      max="24"
                    />
                    <span>hours</span>
                    <input
                      type="number"
                      class="form-input time-input"
                      id="prepMinutes"
                      placeholder="0"
                      min="0"
                      max="59"
                    />
                    <span>minutes</span>
                  </div>
                </div>

                <div class="form-group">
                  <label class="form-label">Cook Time</label>
                  <div class="time-picker">
                    <input
                      type="number"
                      class="form-input time-input"
                      id="cookHours"
                      placeholder="0"
                      min="0"
                      max="24"
                    />
                    <span>hours</span>
                    <input
                      type="number"
                      class="form-input time-input"
                      id="cookMinutes"
                      placeholder="0"
                      min="0"
                      max="59"
                    />
                    <span>minutes</span>
                  </div>
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label class="form-label">Total Time</label>
                  <input
                    type="text"
                    class="form-input"
                    id="totalTime"
                    readonly
                    placeholder="Calculated automatically"
                  />
                </div>

                <div class="form-group">
                  <label class="form-label">Servings</label>
                  <input
                    type="number"
                    class="form-input"
                    id="servings"
                    placeholder="4"
                    min="1"
                    max="50"
                  />
                </div>
              </div>

              <div class="form-group">
                <label class="form-label">Recipe Photo</label>
                <div
                  class="photo-upload"
                  id="photoUpload"
                  onclick="document.getElementById('photoInput').click()"
                >
                  <input
                    type="file"
                    id="photoInput"
                    accept="image/*"
                    style="display: none"
                    onchange="handlePhotoUpload(event)"
                  />
                  <div class="upload-placeholder" id="uploadPlaceholder">
                    <i class="fas fa-camera upload-icon"></i>
                    <p><strong>Click to upload</strong> or drag and drop</p>
                    <p>PNG, JPG, GIF up to 10MB</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Ingredients -->
            <div class="form-section">
              <h3 class="section-title">
                <i class="fas fa-list section-icon"></i>
                Ingredients
              </h3>

              <div class="dynamic-list" id="ingredientsList">
                <div class="list-item">
                  <i class="fas fa-grip-vertical drag-handle"></i>
                  <div class="ingredient-inputs">
                    <input
                      type="text"
                      class="form-input"
                      placeholder="1"
                      title="Quantity"
                    />
                    <select class="form-select" title="Unit">
                      <option value="">Unit</option>
                      <option value="cup">cup</option>
                      <option value="tbsp">tbsp</option>
                      <option value="tsp">tsp</option>
                      <option value="lb">lb</option>
                      <option value="oz">oz</option>
                      <option value="g">g</option>
                      <option value="kg">kg</option>
                      <option value="ml">ml</option>
                      <option value="l">l</option>
                      <option value="piece">piece</option>
                      <option value="clove">clove</option>
                      <option value="pinch">pinch</option>
                    </select>
                    <input
                      type="text"
                      class="form-input"
                      placeholder="Ingredient name"
                    />
                  </div>
                  <button class="remove-btn" onclick="removeIngredient(this)">
                    <i class="fas fa-times"></i>
                  </button>
                </div>
              </div>

              <button class="add-item-btn" onclick="addIngredient()">
                <i class="fas fa-plus"></i> Add Ingredient
              </button>
            </div>

            <!-- Instructions -->
            <div class="form-section">
              <h3 class="section-title">
                <i class="fas fa-list-ol section-icon"></i>
                Instructions
              </h3>

              <div class="dynamic-list" id="instructionsList">
                <div class="list-item">
                  <i class="fas fa-grip-vertical drag-handle"></i>
                  <span
                    style="font-weight: 600; color: #d4735a; min-width: 20px"
                    >1.</span
                  >
                  <textarea
                    class="form-textarea step-input"
                    placeholder="Describe this step in detail..."
                    rows="2"
                  ></textarea>
                  <button class="remove-btn" onclick="removeInstruction(this)">
                    <i class="fas fa-times"></i>
                  </button>
                </div>
              </div>

              <button class="add-item-btn" onclick="addInstruction()">
                <i class="fas fa-plus"></i> Add Step
              </button>
            </div>

            <!-- Additional Information -->
            <div class="form-section">
              <h3 class="section-title">
                <i class="fas fa-sticky-note section-icon"></i>
                Additional Information
              </h3>

              <div class="form-group">
                <label class="form-label">Chef's Notes & Tips</label>
                <textarea
                  class="form-textarea"
                  id="chefNotes"
                  placeholder="Share any special tips, variations, or notes about this recipe..."
                  rows="4"
                ></textarea>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label class="form-label">Storage Instructions</label>
                  <textarea
                    class="form-textarea"
                    id="storage"
                    placeholder="How should leftovers be stored?"
                    rows="2"
                  ></textarea>
                </div>

                <div class="form-group">
                  <label class="form-label">Make-Ahead Tips</label>
                  <textarea
                    class="form-textarea"
                    id="makeAhead"
                    placeholder="Can parts be prepared in advance?"
                    rows="2"
                  ></textarea>
                </div>
              </div>
            </div>
          </div>

          <!-- Paste & Format Mode -->
          <div id="pasteMode" class="paste-container">
            <div class="form-section">
              <h3 class="section-title">
                <i class="fas fa-magic section-icon"></i>
                AI-Assisted Recipe Entry
              </h3>

              <div class="form-group">
                <label class="form-label">Paste Your Recipe</label>
                <textarea
                  class="paste-area"
                  id="pasteArea"
                  placeholder="Paste your recipe here from any website, cookbook, or handwritten notes...

For example:
'Chocolate Chip Cookies

Ingredients:
- 2 cups all-purpose flour  
- 1 tsp baking soda
- 1 cup butter, softened
- 3/4 cup granulated sugar
- 2 large eggs
- 2 cups chocolate chips

Instructions:
1. Preheat oven to 375°F
2. Mix flour and baking soda in bowl
3. Cream butter and sugar until fluffy
4. Beat in eggs one at a time
5. Gradually blend in flour mixture
6. Stir in chocolate chips
7. Drop rounded tablespoons on ungreased cookie sheets
8. Bake 9-11 minutes until golden brown

Makes about 48 cookies. Prep: 15 min, Bake: 10 min per batch'"
                ></textarea>
              </div>

              <button
                class="recipe-btn recipe-btn-primary format-button"
                onclick="formatRecipe()"
              >
                <i class="fas fa-magic"></i> Format Recipe with AI
              </button>

              <div class="ai-results" id="aiResults">
                <h4 style="color: #d4735a; margin-bottom: 1rem">
                  AI Formatting Results
                </h4>
                <p style="color: #666; margin-bottom: 1rem">
                  Review the extracted information below and make any necessary
                  edits:
                </p>

                <div class="ai-section">
                  <h4>Recipe Title</h4>
                  <div class="ai-content" id="aiTitle">
                    Chocolate Chip Cookies
                  </div>
                  <div class="ai-actions">
                    <button class="recipe-btn recipe-btn-outline recipe-btn-sm">
                      ✓ Looks Good
                    </button>
                    <button
                      class="recipe-btn recipe-btn-secondary recipe-btn-sm"
                    >
                      Edit
                    </button>
                  </div>
                </div>

                <div class="ai-section">
                  <h4>Ingredients</h4>
                  <div class="ai-content" id="aiIngredients">
                    <ul style="list-style: none; padding: 0">
                      <li>2 cups all-purpose flour</li>
                      <li>1 tsp baking soda</li>
                      <li>1 cup butter, softened</li>
                      <li>3/4 cup granulated sugar</li>
                      <li>2 large eggs</li>
                      <li>2 cups chocolate chips</li>
                    </ul>
                  </div>
                  <div class="ai-actions">
                    <button class="recipe-btn recipe-btn-outline recipe-btn-sm">
                      ✓ Looks Good
                    </button>
                    <button
                      class="recipe-btn recipe-btn-secondary recipe-btn-sm"
                    >
                      Edit
                    </button>
                  </div>
                </div>

                <div class="ai-section">
                  <h4>Instructions</h4>
                  <div class="ai-content" id="aiInstructions">
                    <ol>
                      <li>Preheat oven to 375°F</li>
                      <li>Mix flour and baking soda in bowl</li>
                      <li>Cream butter and sugar until fluffy</li>
                      <li>Beat in eggs one at a time</li>
                      <li>Gradually blend in flour mixture</li>
                      <li>Stir in chocolate chips</li>
                      <li>
                        Drop rounded tablespoons on ungreased cookie sheets
                      </li>
                      <li>Bake 9-11 minutes until golden brown</li>
                    </ol>
                  </div>
                  <div class="ai-actions">
                    <button class="recipe-btn recipe-btn-outline recipe-btn-sm">
                      ✓ Looks Good
                    </button>
                    <button
                      class="recipe-btn recipe-btn-secondary recipe-btn-sm"
                    >
                      Edit
                    </button>
                  </div>
                </div>

                <div class="ai-section">
                  <h4>Recipe Details</h4>
                  <div class="ai-content" id="aiDetails">
                    <p>
                      <strong>Prep Time:</strong> 15 minutes<br />
                      <strong>Cook Time:</strong> 10 minutes per batch<br />
                      <strong>Servings:</strong> 48 cookies
                    </p>
                  </div>
                  <div class="ai-actions">
                    <button class="recipe-btn recipe-btn-outline recipe-btn-sm">
                      ✓ Looks Good
                    </button>
                    <button
                      class="recipe-btn recipe-btn-secondary recipe-btn-sm"
                    >
                      Edit
                    </button>
                  </div>
                </div>

                <div style="margin-top: 1.5rem; text-align: center">
                  <button
                    class="recipe-btn recipe-btn-primary"
                    onclick="acceptAIFormat()"
                  >
                    <i class="fas fa-check"></i> Use This Format
                  </button>
                  <button
                    class="recipe-btn recipe-btn-outline"
                    onclick="switchToManual()"
                  >
                    <i class="fas fa-edit"></i> Switch to Manual Entry
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Preview Panel -->
        <div class="preview-panel">
          <div class="preview-title">Live Preview</div>
          <div class="preview-recipe">
            <div class="preview-image" id="previewImage">
              <i class="fas fa-image" style="font-size: 2rem"></i>
            </div>
            <div class="preview-content">
              <h3 class="preview-recipe-title" id="previewTitle">
                Your Recipe Title
              </h3>
              <div class="preview-meta" id="previewMeta">
                <span><i class="fas fa-clock"></i> -- min</span>
                <span><i class="fas fa-users"></i> -- servings</span>
                <span><i class="fas fa-signal"></i> --</span>
              </div>
              <p id="previewDescription">
                Recipe description will appear here...
              </p>

              <div class="preview-ingredients">
                <h4>Ingredients</h4>
                <ul id="previewIngredientsList">
                  <li>Add ingredients to see them here</li>
                </ul>
              </div>

              <div class="preview-instructions">
                <h4>Instructions</h4>
                <ol id="previewInstructionsList">
                  <li>Add instructions to see them here</li>
                </ol>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Global variables
      let isDirty = false;
      let autoSaveTimeout;
      let currentMode = "manual";

      // Initialize
      document.addEventListener("DOMContentLoaded", function () {
        setupEventListeners();
        updatePreview();
        startAutoSave();
      });

      // Mode switching
      function switchMode(mode) {
        currentMode = mode;

        // Update tab appearance
        document.querySelectorAll(".mode-tab").forEach((tab) => {
          tab.classList.remove("active");
        });
        event.target.classList.add("active");

        // Show/hide appropriate containers
        if (mode === "manual") {
          document.getElementById("manualMode").style.display = "block";
          document.getElementById("pasteMode").style.display = "none";
        } else {
          document.getElementById("manualMode").style.display = "none";
          document.getElementById("pasteMode").style.display = "block";
        }
      }

      // Setup event listeners
      function setupEventListeners() {
        // Form inputs
        const inputs = [
          "recipeTitle",
          "recipeDescription",
          "recipeCategory",
          "recipeDifficulty",
          "recipeTags",
          "prepHours",
          "prepMinutes",
          "cookHours",
          "cookMinutes",
          "servings",
          "chefNotes",
          "storage",
          "makeAhead",
        ];

        inputs.forEach((id) => {
          const element = document.getElementById(id);
          if (element) {
            element.addEventListener("input", handleInputChange);
          }
        });

        // Tags handling
        document
          .getElementById("recipeTags")
          .addEventListener("keydown", handleTagInput);

        // Time calculation
        ["prepHours", "prepMinutes", "cookHours", "cookMinutes"].forEach(
          (id) => {
            const element = document.getElementById(id);
            if (element) {
              element.addEventListener("input", calculateTotalTime);
            }
          }
        );

        // Dynamic lists
        setupDynamicLists();

        // Photo upload drag & drop
        setupPhotoUpload();

        // Prevent accidental navigation
        window.addEventListener("beforeunload", function (e) {
          if (isDirty) {
            e.preventDefault();
            e.returnValue = "";
          }
        });
      }

      // Handle input changes
      function handleInputChange(e) {
        isDirty = true;
        updatePreview();
        scheduleAutoSave();
      }

      // Handle tag input
      function handleTagInput(e) {
        if (e.key === "Enter" || e.key === ",") {
          e.preventDefault();
          addTag();
        }
      }

      // Add tag
      function addTag() {
        const input = document.getElementById("recipeTags");
        const tag = input.value.trim().replace(",", "");

        if (tag && !isTagExists(tag)) {
          const tagsContainer = document.getElementById("tagsContainer");
          const tagElement = document.createElement("div");
          tagElement.className = "tag";
          tagElement.innerHTML = `
                    ${tag}
                    <button class="tag-remove" onclick="removeTag(this)">×</button>
                `;
          tagsContainer.appendChild(tagElement);
          input.value = "";
          handleInputChange();
        }
      }

      // Check if tag exists
      function isTagExists(tagText) {
        const existingTags = document.querySelectorAll(".tag");
        return Array.from(existingTags).some(
          (tag) => tag.textContent.trim().replace("×", "") === tagText
        );
      }

      // Remove tag
      function removeTag(button) {
        button.parentElement.remove();
        handleInputChange();
      }

      // Calculate total time
      function calculateTotalTime() {
        const prepHours =
          parseInt(document.getElementById("prepHours").value) || 0;
        const prepMinutes =
          parseInt(document.getElementById("prepMinutes").value) || 0;
        const cookHours =
          parseInt(document.getElementById("cookHours").value) || 0;
        const cookMinutes =
          parseInt(document.getElementById("cookMinutes").value) || 0;

        const totalMinutes =
          prepHours * 60 + prepMinutes + cookHours * 60 + cookMinutes;
        const hours = Math.floor(totalMinutes / 60);
        const minutes = totalMinutes % 60;

        let totalTime = "";
        if (hours > 0) {
          totalTime += hours + (hours === 1 ? " hour" : " hours");
        }
        if (minutes > 0) {
          if (totalTime) totalTime += " ";
          totalTime += minutes + (minutes === 1 ? " minute" : " minutes");
        }

        document.getElementById("totalTime").value = totalTime || "";
      }

      // Dynamic list management
      function setupDynamicLists() {
        // Make lists sortable (simplified version)
        const lists = document.querySelectorAll(".dynamic-list");
        lists.forEach((list) => {
          // Add event listeners for drag functionality here if needed
        });
      }

      // Add ingredient
      function addIngredient() {
        const list = document.getElementById("ingredientsList");
        const newItem = document.createElement("div");
        newItem.className = "list-item";
        newItem.innerHTML = `
                <i class="fas fa-grip-vertical drag-handle"></i>
                <div class="ingredient-inputs">
                    <input type="text" class="form-input" placeholder="1" title="Quantity">
                    <select class="form-select" title="Unit">
                        <option value="">Unit</option>
                        <option value="cup">cup</option>
                        <option value="tbsp">tbsp</option>
                        <option value="tsp">tsp</option>
                        <option value="lb">lb</option>
                        <option value="oz">oz</option>
                        <option value="g">g</option>
                        <option value="kg">kg</option>
                        <option value="ml">ml</option>
                        <option value="l">l</option>
                        <option value="piece">piece</option>
                        <option value="clove">clove</option>
                        <option value="pinch">pinch</option>
                    </select>
                    <input type="text" class="form-input" placeholder="Ingredient name">
                </div>
                <button class="remove-recipe-btn" onclick="removeIngredient(this)">
                    <i class="fas fa-times"></i>
                </button>
            `;

        // Add event listeners to new inputs
        newItem.querySelectorAll("input, select").forEach((input) => {
          input.addEventListener("input", handleInputChange);
        });

        list.appendChild(newItem);
        handleInputChange();
      }

      // Remove ingredient
      function removeIngredient(button) {
        button.parentElement.remove();
        handleInputChange();
      }

      // Add instruction
      function addInstruction() {
        const list = document.getElementById("instructionsList");
        const stepNumber = list.children.length + 1;
        const newItem = document.createElement("div");
        newItem.className = "list-item";
        newItem.innerHTML = `
                <i class="fas fa-grip-vertical drag-handle"></i>
                <span style="font-weight: 600; color: #d4735a; min-width: 20px;">${stepNumber}.</span>
                <textarea class="form-textarea step-input" placeholder="Describe this step in detail..." rows="2"></textarea>
                <button class="remove-recipe-btn" onclick="removeInstruction(this)">
                    <i class="fas fa-times"></i>
                </button>
            `;

        // Add event listener to new textarea
        newItem
          .querySelector("textarea")
          .addEventListener("input", handleInputChange);

        list.appendChild(newItem);
        updateInstructionNumbers();
        handleInputChange();
      }

      // Remove instruction
      function removeInstruction(button) {
        button.parentElement.remove();
        updateInstructionNumbers();
        handleInputChange();
      }

      // Update instruction numbers
      function updateInstructionNumbers() {
        const instructions = document.querySelectorAll(
          "#instructionsList .list-item"
        );
        instructions.forEach((item, index) => {
          const numberSpan = item.querySelector("span");
          if (numberSpan) {
            numberSpan.textContent = index + 1 + ".";
          }
        });
      }

      // Photo upload handling
      function setupPhotoUpload() {
        const photoUpload = document.getElementById("photoUpload");

        // Drag and drop
        photoUpload.addEventListener("dragover", function (e) {
          e.preventDefault();
          this.style.borderColor = "#b85c42";
          this.style.background = "#fef9f7";
        });

        photoUpload.addEventListener("dragleave", function (e) {
          e.preventDefault();
          this.style.borderColor = "#d4735a";
          this.style.background = "";
        });

        photoUpload.addEventListener("drop", function (e) {
          e.preventDefault();
          this.style.borderColor = "#d4735a";
          this.style.background = "";

          const files = e.dataTransfer.files;
          if (files.length > 0) {
            handlePhotoFile(files[0]);
          }
        });
      }

      // Handle photo upload
      function handlePhotoUpload(event) {
        const file = event.target.files[0];
        if (file) {
          handlePhotoFile(file);
        }
      }

      // Process photo file
      function handlePhotoFile(file) {
        if (file.type.startsWith("image/") && file.size <= 10 * 1024 * 1024) {
          const reader = new FileReader();
          reader.onload = function (e) {
            const photoUpload = document.getElementById("photoUpload");
            photoUpload.classList.add("has-image");
            photoUpload.innerHTML = `
                        <img src="${e.target.result}" alt="Recipe" class="recipe-image">
                        <button style="position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.7); color: white; border: none; border-radius: 50%; width: 30px; height: 30px; cursor: pointer;" onclick="removePhoto()">×</button>
                    `;

            // Update preview
            document.getElementById(
              "previewImage"
            ).innerHTML = `<img src="${e.target.result}" alt="Recipe" style="width: 100%; height: 100%; object-fit: cover;">`;
            handleInputChange();
          };
          reader.readAsDataURL(file);
        } else {
          alert("Please upload an image file under 10MB");
        }
      }

      // Remove photo
      function removePhoto() {
        const photoUpload = document.getElementById("photoUpload");
        photoUpload.classList.remove("has-image");
        photoUpload.innerHTML = `
                <input type="file" id="photoInput" accept="image/*" style="display: none;" onchange="handlePhotoUpload(event)">
                <div class="upload-placeholder" id="uploadPlaceholder">
                    <i class="fas fa-camera upload-icon"></i>
                    <p><strong>Click to upload</strong> or drag and drop</p>
                    <p>PNG, JPG, GIF up to 10MB</p>
                </div>
            `;

        document.getElementById("previewImage").innerHTML =
          '<i class="fas fa-image" style="font-size: 2rem;"></i>';
        handleInputChange();
      }

      // Update preview
      function updatePreview() {
        // Title
        const title =
          document.getElementById("recipeTitle").value || "Your Recipe Title";
        document.getElementById("previewTitle").textContent = title;

        // Description
        const description =
          document.getElementById("recipeDescription").value ||
          "Recipe description will appear here...";
        document.getElementById("previewDescription").textContent = description;

        // Meta information
        const totalTime =
          document.getElementById("totalTime").value || "-- min";
        const servings = document.getElementById("servings").value || "--";
        const difficulty =
          document.getElementById("recipeDifficulty").value || "--";

        document.getElementById("previewMeta").innerHTML = `
                <span><i class="fas fa-clock"></i> ${totalTime}</span>
                <span><i class="fas fa-users"></i> ${servings} servings</span>
                <span><i class="fas fa-signal"></i> ${difficulty}</span>
            `;

        // Ingredients
        updatePreviewIngredients();

        // Instructions
        updatePreviewInstructions();
      }

      // Update preview ingredients
      function updatePreviewIngredients() {
        const ingredientsList = document.getElementById(
          "previewIngredientsList"
        );
        const ingredients = document.querySelectorAll(
          "#ingredientsList .list-item"
        );

        if (ingredients.length === 0) {
          ingredientsList.innerHTML =
            "<li>Add ingredients to see them here</li>";
          return;
        }

        ingredientsList.innerHTML = "";
        ingredients.forEach((item) => {
          const inputs = item.querySelectorAll("input, select");
          const quantity = inputs[0].value || "";
          const unit = inputs[1].value || "";
          const name = inputs[2].value || "";

          if (name) {
            const li = document.createElement("li");
            li.textContent = `${quantity} ${unit} ${name}`.trim();
            ingredientsList.appendChild(li);
          }
        });

        if (ingredientsList.children.length === 0) {
          ingredientsList.innerHTML =
            "<li>Add ingredients to see them here</li>";
        }
      }

      // Update preview instructions
      function updatePreviewInstructions() {
        const instructionsList = document.getElementById(
          "previewInstructionsList"
        );
        const instructions = document.querySelectorAll(
          "#instructionsList .step-input"
        );

        if (instructions.length === 0) {
          instructionsList.innerHTML =
            "<li>Add instructions to see them here</li>";
          return;
        }

        instructionsList.innerHTML = "";
        instructions.forEach((textarea) => {
          const text = textarea.value.trim();
          if (text) {
            const li = document.createElement("li");
            li.textContent = text;
            instructionsList.appendChild(li);
          }
        });

        if (instructionsList.children.length === 0) {
          instructionsList.innerHTML =
            "<li>Add instructions to see them here</li>";
        }
      }

      // Auto-save functionality
      function startAutoSave() {
        // Auto-save every 30 seconds
        setInterval(function () {
          if (isDirty) {
            autoSave();
          }
        }, 30000);
      }

      function scheduleAutoSave() {
        clearTimeout(autoSaveTimeout);
        autoSaveTimeout = setTimeout(autoSave, 3000);
      }

      function autoSave() {
        if (!isDirty) return;

        const indicator = document.getElementById("autoSaveIndicator");
        indicator.classList.add("saving", "show");
        indicator.innerHTML = '<div class="spinner"></div> Saving...';

        // Simulate save
        setTimeout(() => {
          indicator.classList.remove("saving");
          indicator.innerHTML = '<i class="fas fa-check"></i> Draft saved';
          isDirty = false;

          setTimeout(() => {
            indicator.classList.remove("show");
          }, 2000);
        }, 1000);
      }

      // AI formatting
      function formatRecipe() {
        const pasteArea = document.getElementById("pasteArea");
        const text = pasteArea.value.trim();

        if (!text) {
          alert("Please paste a recipe first");
          return;
        }

        // Show loading state
        const button = event.target;
        const originalText = button.innerHTML;
        button.innerHTML = '<div class="spinner"></div> Formatting...';
        button.disabled = true;

        // Simulate AI processing
        setTimeout(() => {
          document.getElementById("aiResults").classList.add("show");
          button.innerHTML = originalText;
          button.disabled = false;

          // Scroll to results
          document
            .getElementById("aiResults")
            .scrollIntoView({ behavior: "smooth" });
        }, 2000);
      }

      // Accept AI format
      function acceptAIFormat() {
        // Switch to manual mode and populate fields
        switchMode("manual");
        document.querySelector(".mode-tab").click();

        // Populate form with AI results (simplified)
        document.getElementById("recipeTitle").value = "Chocolate Chip Cookies";
        document.getElementById("prepMinutes").value = "15";
        document.getElementById("cookMinutes").value = "10";
        document.getElementById("servings").value = "48";

        handleInputChange();
        updatePreview();
      }

      // Switch to manual from AI
      function switchToManual() {
        switchMode("manual");
        document.querySelector(".mode-tab").click();
      }

      // Action buttons
      function handleCancel() {
        if (isDirty) {
          if (
            confirm("You have unsaved changes. Are you sure you want to leave?")
          ) {
            // Navigate away
            window.location.href = "/";
          }
        } else {
          window.location.href = "/";
        }
      }

      function saveDraft() {
        const button = event.target;
        const originalText = button.innerHTML;
        button.innerHTML = '<div class="spinner"></div> Saving...';
        button.disabled = true;

        setTimeout(() => {
          button.innerHTML = '<i class="fas fa-check"></i> Saved!';
          setTimeout(() => {
            button.innerHTML = originalText;
            button.disabled = false;
            isDirty = false;
          }, 1000);
        }, 1500);
      }

      function publishRecipe() {
        // Validate required fields
        const title = document.getElementById("recipeTitle").value.trim();
        if (!title) {
          alert("Please enter a recipe title");
          document.getElementById("recipeTitle").focus();
          return;
        }

        const button = event.target;
        const originalText = button.innerHTML;
        button.innerHTML = '<div class="spinner"></div> Publishing...';
        button.disabled = true;

        setTimeout(() => {
          button.innerHTML = '<i class="fas fa-check"></i> Published!';
          setTimeout(() => {
            // Simulate navigation to published recipe
            alert("Recipe published successfully!");
            button.innerHTML = originalText;
            button.disabled = false;
            isDirty = false;
          }, 1000);
        }, 2000);
      }
    </script>
  </body>
</html>
