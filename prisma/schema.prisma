// Cookbook MVP Schema


generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String    @id @default(uuid())
  username     String    @unique
  email        String    @unique
  passwordHash String
  avatarUrl    String?
  bio          String?
  role         String    @default("USER")
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  recipes       Recipe[]
  reviews       Review[]
  favoriteRecipes FavoriteRecipe[]
}

model Recipe {
  id              String             @id @default(uuid())
  authorId        String
  title           String
  slug            String?            @unique
  description     String?
  instructions    String?
  servings        Int?
  prepTimeMinutes Int?
  cookTimeMinutes Int?
  difficulty      String?
  imageUrl        String?
  isPublished     Boolean            @default(false)
  calories        Int?
  proteinG        Int?
  fatG            Int?
  carbsG          Int?
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt

  author          User               @relation(fields: [authorId], references: [id])
  ingredients     RecipeIngredient[]
  categories      RecipesCategories[]
  tags            RecipesTags[]
  reviews         Review[]
  favorites       FavoriteRecipe[]
  allergens       RecipesAllergens[]
}

model RecipeIngredient {
  id            String   @id @default(uuid())
  recipeId      String
  amount        Decimal?
  unit          String?
  name          String
  displayOrder  Int      @default(0)
  
  recipe        Recipe   @relation(fields: [recipeId], references: [id], onDelete: Cascade)
}

model Category {
  id        String              @id @default(uuid())
  name      String              @unique
  parentId  String?
  parent    Category?           @relation("CategoryToParent", fields: [parentId], references: [id])
  children  Category[]          @relation("CategoryToParent")
  recipes   RecipesCategories[]
}

model RecipesCategories {
  recipeId    String
  categoryId  String

  recipe      Recipe   @relation(fields: [recipeId], references: [id], onDelete: Cascade)
  category    Category @relation(fields: [categoryId], references: [id])

  @@id([recipeId, categoryId])
}

model Tag {
  id      String         @id @default(uuid())
  name    String         @unique
  recipes RecipesTags[]
}

model RecipesTags {
  recipeId String
  tagId    String

  recipe   Recipe @relation(fields: [recipeId], references: [id], onDelete: Cascade)
  tag      Tag    @relation(fields: [tagId], references: [id])

  @@id([recipeId, tagId])
}

model Review {
  id         String    @id @default(uuid())
  recipeId   String
  userId     String
  rating     Int
  comment    String?
  createdAt  DateTime  @default(now())

  recipe     Recipe    @relation(fields: [recipeId], references: [id], onDelete: Cascade)
  user       User      @relation(fields: [userId], references: [id])
}

model FavoriteRecipe {
  userId     String
  recipeId   String
  createdAt  DateTime @default(now())

  user       User     @relation(fields: [userId], references: [id])
  recipe     Recipe   @relation(fields: [recipeId], references: [id], onDelete: Cascade)

  @@id([userId, recipeId])
}

model Allergen {
  id      String              @id @default(uuid())
  name    String              @unique
  recipes RecipesAllergens[]
}

model RecipesAllergens {
  recipeId   String
  allergenId String

  recipe     Recipe   @relation(fields: [recipeId], references: [id], onDelete: Cascade)
  allergen   Allergen @relation(fields: [allergenId], references: [id])

  @@id([recipeId, allergenId])
}
